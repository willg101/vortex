		<VirtualHost *:80>
			ServerName vortex-v2.wgroenen.dart.ccel.org
			

        RewriteEngine On
        RewriteCond %{REQUEST_URI} ^/api/v4/websocket [NC,OR]
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC,OR]
        RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
        RewriteRule .* ws://127.0.0.1:38383%{REQUEST_URI} [P,QSA,L]
        RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
        RewriteRule .* http://127.0.0.1:38383%{REQUEST_URI} [P,QSA,L]

        RequestHeader unset If-Modified-Since
        RequestHeader unset If-None-Match

        <Location />
                Require all granted
                ProxyPassReverse http://127.0.0.1:38383/
                ProxyPassReverseCookieDomain 127.0.0.1 vortex-v2.wgroenen.dart.ccel.org
        </Location>

        ProxyPreserveHost On
        ProxyRequests Off

			

			LogFormat "%h %l %u %t \"%r\" %>s %b %v \"%{Referer}i\" \"%{User-agent}i\"" dart_site
			ErrorLog ${APACHE_LOG_DIR}/vortex-v2.wgroenen.dart.ccel.org-error.log
			CustomLog ${APACHE_LOG_DIR}/vortex-v2.wgroenen.dart.ccel.org-access.log dart_site

			RewriteEngine on
			RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
		</VirtualHost>

<VirtualHost *:443>
        ServerName vortex-v2.wgroenen.dart.ccel.org
        ServerAdmin webmaster@vortex-v2.wgroenen.dart.ccel.org

        ### BEGIN Let's Encrypt defaults ###
        SSLEngine on

        SSLProtocol             all -SSLv2 -SSLv3
        SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS
        SSLHonorCipherOrder     on
        SSLCompression          off

        SSLOptions +StrictRequire

        # Add vhost name to log entries:
        LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" vhost_combined
        LogFormat "%v %h %l %u %t \"%r\" %>s %b" vhost_common

        # Always ensure Cookies have "Secure" set (JAH 2012/1)
        #Header edit Set-Cookie (?i)^(.*)(;\s*secure)??((\s*;)?(.*)) "ccel3_649523; Secure12752"
        ### END Let's Encrypt defaults ###

        SSLCertificateFile      /etc/dart/certs/cert.pem
        SSLCertificateKeyFile   /etc/dart/certs/privkey.pem
        SSLCertificateChainFile /etc/dart/certs/chain.pem

        ErrorLog ${APACHE_LOG_DIR}/vortex-v2-error.log
        CustomLog ${APACHE_LOG_DIR}/vortex-v2-access.log combined
        RequestHeader set X-Forwarded-Proto "https"

        RequestHeader unset If-Modified-Since
        RequestHeader unset If-None-Match

        RewriteEngine On
        RewriteCond %{REQUEST_URI} ^/api/v4/websocket [NC,OR]
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC,OR]
        RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
        RewriteRule .* ws://vortex-v2.wgroenen.dart.ccel.org:38383%{REQUEST_URI} [P,QSA,L]
        RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
        RewriteRule .* http://vortex-v2.wgroenen.dart.ccel.org:38383%{REQUEST_URI} [P,QSA,L]
        RequestHeader set X-Forwarded-Proto "https"

        RequestHeader unset If-Modified-Since
        RequestHeader unset If-None-Match

        <Location />
                Require all granted
                ProxyPassReverse http://127.0.0.1:38383/
                ProxyPassReverseCookieDomain 127.0.0.1 vortex-v2.wgroenen.dart.ccel.org
        </Location>

        ProxyPreserveHost On
        ProxyRequests Off
</VirtualHost>
