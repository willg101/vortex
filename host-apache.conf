		<VirtualHost *:80>
			ServerName vortex-v2.wgroenen.dart.ccel.org
			

        RewriteEngine On
        RewriteCond %{REQUEST_URI} ^/api/v4/websocket [NC,OR]
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC,OR]
        RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
        RewriteRule .* ws://127.0.0.1:38383%{REQUEST_URI} [P,QSA,L]
        RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
        RewriteRule .* http://127.0.0.1:38383%{REQUEST_URI} [P,QSA,L]

        RequestHeader unset If-Modified-Since
        RequestHeader unset If-None-Match

        <Location />
                Require all granted
                ProxyPassReverse http://127.0.0.1:38383/
                ProxyPassReverseCookieDomain 127.0.0.1 vortex-v2.wgroenen.dart.ccel.org
        </Location>

        ProxyPreserveHost On
        ProxyRequests Off

			

			LogFormat "%h %l %u %t \"%r\" %>s %b %v \"%{Referer}i\" \"%{User-agent}i\"" dart_site
			ErrorLog ${APACHE_LOG_DIR}/vortex-v2.wgroenen.dart.ccel.org-error.log
			CustomLog ${APACHE_LOG_DIR}/vortex-v2.wgroenen.dart.ccel.org-access.log dart_site

			RewriteEngine on
			RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
		</VirtualHost>

<VirtualHost *:443>
        ServerName vortex-v2.wgroenen.dart.ccel.org

        SSLEngine on

        SSLCertificateFile      /etc/dart/certs/cert.pem
        SSLCertificateKeyFile   /etc/dart/certs/privkey.pem
        SSLCertificateChainFile /etc/dart/certs/chain.pem

        ErrorLog ${APACHE_LOG_DIR}/vortex-v2-error.log
        CustomLog ${APACHE_LOG_DIR}/vortex-v2-access.log combined

        RewriteEngine On
        RewriteCond %{REQUEST_URI} ^pubsub [NC,OR]
        RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC,OR]
        RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC]
        RewriteRule .* ws://vortex-v2.wgroenen.dart.ccel.org:38383%{REQUEST_URI} [P,QSA,L]
        RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
        RewriteRule .* http://vortex-v2.wgroenen.dart.ccel.org:38383%{REQUEST_URI} [P,QSA,L]

        ## ***************************************************************************************
        ## ************** NOTE: I had to clear cookies to connect to websocket *******************
        ## ***************************************************************************************

        <Location />
                Require all granted
                ProxyPassReverse http://vortex-v2.wgroenen.dart.ccel.org:38383/
        </Location>

        ProxyPreserveHost On
        ProxyRequests Off
</VirtualHost>
